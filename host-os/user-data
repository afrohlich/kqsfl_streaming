#cloud-config
#server target - Ubuntu Server 24.04.2
autoinstall:
  version: 1
  identity:
    hostname: streambox
    #password=streambox    |    generated with `openssl passwd -6 streambox`
    password: "$6$JSHDhRNbhHqVg4y2$OxbsRMm2OFtsJNt39iLIGj/cqj/94uw3x4b/zJjKoMD/.ADvCLE6UxmuKB8q/K/1upgd4RfawHcaYlRI0FcVr1"
    username: stream-admin
  ssh:
    install-server: yes
    allow-pw: yes
  packages:
    # This list assumes internet access via ethernet during the install
    - wpasupplicant
    - network-manager
    - wireless-tools
  late-commands:
    - |
      cat > /target/etc/netplan/99-wifi.yaml.template << NETPLAN
      network:
        version: 2
        wifis:
          wlo1:
            access-points:
              "SSID_HERE":
                password: "PASSWORD"
            dhcp4: true
      NETPLAN
      
      chmod 600 /etc/netplan/99-wifi.yaml.template
    - |
      cat << NEXT_STEPS
      This autoinstall does not assume network connectivity.
      The expectation is that you will configure the network and install all packages separately.

      If Wi-fi is required.
      Modify /etc/netplan/99-wifi.yaml.template
      Change the filename to /etc/netplan/99-wifi.yaml
      Run netplan apply
      NEXT_STEPS
