[Unit]
Description=kasmvnc
After=network.target graphical.target
Requires=lightdm.service
ConditionPathExists=/tmp/.X11-unix/X0
ConditionPathExists=/home/{{kasmvnc_user}}/.Xauthority

[Service]
User={{kasmvnc_user}}
# TODO: replace 'sleep 5'. `/usr/bin/sleep 5` is a hack to
#   ensure that the necessary display components are available before the vnc is started 
ExecStartPre=/bin/sleep 5
ExecStart=/usr/bin/vncserver :1 {{ '-disableBasicAuth' if not kasmvnc_basic_auth }}
# ExecStop unnecessary if not using "-fg" option and using "Type=forking"
ExecStop=/usr/bin/vncserver -kill :1
Restart=on-failure
RestartSec=10
Type=forking

[Install]
WantedBy=graphical.target